module.exports=[18622,(a,b,c)=>{b.exports=a.x("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js",()=>require("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js"))},42602,(a,b,c)=>{"use strict";b.exports=a.r(18622)},87924,(a,b,c)=>{"use strict";b.exports=a.r(42602).vendored["react-ssr"].ReactJsxRuntime},72131,(a,b,c)=>{"use strict";b.exports=a.r(42602).vendored["react-ssr"].React},9270,(a,b,c)=>{"use strict";b.exports=a.r(42602).vendored.contexts.AppRouterContext},38783,(a,b,c)=>{"use strict";b.exports=a.r(42602).vendored["react-ssr"].ReactServerDOMTurbopackClient},46058,(a,b,c)=>{"use strict";function d(a){if("function"!=typeof WeakMap)return null;var b=new WeakMap,c=new WeakMap;return(d=function(a){return a?c:b})(a)}c._=function(a,b){if(!b&&a&&a.__esModule)return a;if(null===a||"object"!=typeof a&&"function"!=typeof a)return{default:a};var c=d(b);if(c&&c.has(a))return c.get(a);var e={__proto__:null},f=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var g in a)if("default"!==g&&Object.prototype.hasOwnProperty.call(a,g)){var h=f?Object.getOwnPropertyDescriptor(a,g):null;h&&(h.get||h.set)?Object.defineProperty(e,g,h):e[g]=a[g]}return e.default=a,c&&c.set(a,e),e}},39118,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0});var d={DEFAULT_SEGMENT_KEY:function(){return l},NOT_FOUND_SEGMENT_KEY:function(){return m},PAGE_SEGMENT_KEY:function(){return k},addSearchParamsIfPageSegment:function(){return i},computeSelectedLayoutSegment:function(){return j},getSegmentValue:function(){return f},getSelectedLayoutSegmentPath:function(){return function a(b,c,d=!0,e=[]){let g;if(d)g=b[1][c];else{let a=b[1];g=a.children??Object.values(a)[0]}if(!g)return e;let h=f(g[0]);return!h||h.startsWith(k)?e:(e.push(h),a(g,c,!1,e))}},isGroupSegment:function(){return g},isParallelRouteSegment:function(){return h}};for(var e in d)Object.defineProperty(c,e,{enumerable:!0,get:d[e]});function f(a){return Array.isArray(a)?a[1]:a}function g(a){return"("===a[0]&&a.endsWith(")")}function h(a){return a.startsWith("@")&&"@children"!==a}function i(a,b){if(a.includes(k)){let a=JSON.stringify(b);return"{}"!==a?k+"?"+a:k}return a}function j(a,b){if(!a||0===a.length)return null;let c="children"===b?a[0]:a[a.length-1];return c===l?null:c}let k="__PAGE__",l="__DEFAULT__",m="/_not-found"},24304,a=>{"use strict";var b=a.i(87924),c=a.i(72131);function d({circleId:a,currentUserId:d}){let[e,f]=(0,c.useState)([]),[g,h]=(0,c.useState)([]),[i,j]=(0,c.useState)(!1),[k,l]=(0,c.useState)(0),[m,n]=(0,c.useState)(!1),[o,p]=(0,c.useState)(null),[q,r]=(0,c.useState)(0),[s,t]=(0,c.useState)(0),[u,v]=(0,c.useState)(null),[w,x]=(0,c.useState)(null),[y,z]=(0,c.useState)(!1),[A,B]=(0,c.useState)(null),[C,D]=(0,c.useState)(""),E=(0,c.useRef)(null),F=(0,c.useRef)([]),G=(0,c.useRef)(null),H=(0,c.useRef)(null),I=(0,c.useRef)(""),J=(0,c.useRef)(null),K=(0,c.useCallback)(async()=>{let b=await fetch(`/api/circles/${a}`);if(b.ok){let a=await b.json();f(a.waffles),h(a.members)}},[a]);async function L(){B(null);try{let a=await navigator.mediaDevices.getUserMedia({audio:!0}),b=new MediaRecorder(a);F.current=[],b.ondataavailable=a=>{a.data.size>0&&F.current.push(a.data)},E.current=b,b.start(),j(!0),l(0),I.current="",G.current=setInterval(()=>l(a=>a+1),1e3)}catch{B("Could not access your microphone.")}}async function M(){let b=I.current.trim();E.current&&"inactive"!==E.current.state&&(E.current.onstop=async()=>{E.current.stream.getTracks().forEach(a=>a.stop());let c=new Blob(F.current,{type:"audio/webm"});n(!0);let d=new FormData;d.append("circleId",a),d.append("audio",c,"waffle.webm"),d.append("duration",String(k)),d.append("transcript",b),await fetch("/api/waffles",{method:"POST",body:d}),n(!1),l(0),K()},E.current.stop()),j(!1),G.current&&clearInterval(G.current)}function N(){H.current&&(H.current.pause(),H.current=null),p(null),r(0),t(0)}function O(a){if(H.current&&(H.current.pause(),H.current=null),o===a)return void N();let b=new Audio(`/api/waffles/audio/${a}`);b.onended=()=>N(),b.onerror=()=>N(),b.ontimeupdate=()=>r(b.currentTime),b.onloadedmetadata=()=>t(b.duration),b.play().catch(()=>N()),H.current=b,p(a),r(0)}function P(a){H.current&&(H.current.currentTime=a,r(a))}async function Q(a){C.trim()&&(await fetch(`/api/waffles/comments/${a}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({text:C.trim(),timestampSeconds:o===a?q:0})}),D(""),K())}async function R(){let b=await fetch("/api/circles/invite",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({circleId:a})});b.ok&&x((await b.json()).url)}async function S(){w&&(await navigator.clipboard.writeText(w),z(!0),setTimeout(()=>z(!1),2e3))}function T(a){let b=Math.floor(a);return`${Math.floor(b/60)}:${(b%60).toString().padStart(2,"0")}`}return(0,c.useEffect)(()=>{K()},[K]),(0,c.useEffect)(()=>{J.current&&(J.current.scrollTop=J.current.scrollHeight)},[e]),(0,b.jsxs)("div",{className:"flex min-h-0 flex-1 flex-col",children:[(0,b.jsxs)("div",{className:"mb-3 flex flex-wrap items-center gap-2",children:[(0,b.jsx)("span",{className:"text-xs font-semibold text-waffle-dark/60",children:"Members:"}),g.map(a=>(0,b.jsx)("span",{className:`rounded-full px-2 py-0.5 text-xs font-semibold ${a.id===d?"bg-waffle text-white":"bg-butter text-waffle-dark"}`,children:a.display_name},a.id)),w?(0,b.jsx)("button",{onClick:S,className:"rounded-full bg-butter-deep px-2 py-0.5 text-xs font-semibold text-syrup",children:y?"Copied!":"Copy invite link"}):(0,b.jsx)("button",{onClick:R,className:"rounded-full bg-butter-deep px-2 py-0.5 text-xs font-semibold text-syrup",children:"+ Invite"})]}),(0,b.jsxs)("div",{ref:J,className:"flex-1 space-y-3 overflow-y-auto pb-4",children:[0===e.length&&!i&&(0,b.jsxs)("div",{className:"card-cottage bg-waffle-texture p-7 text-center",children:[(0,b.jsx)("p",{className:"font-display mb-2 text-lg font-semibold text-syrup",children:"No waffles yet!"}),(0,b.jsx)("p",{className:"text-sm leading-relaxed text-waffle-dark/80",children:"Record the first waffle below."})]}),e.map(a=>{let c=a.sender_id===d,e=u===a.id,f=o===a.id,g=f&&s>0?q/s:0;return(0,b.jsxs)("div",{className:`flex flex-col ${c?"items-end":"items-start"}`,children:[(0,b.jsxs)("div",{onClick:()=>{v(e?null:a.id),D("")},className:`max-w-[320px] cursor-pointer px-4 py-3 transition-all ${c?"bubble-mine":"bubble-theirs"} ${e?"ring-2 ring-waffle-light ring-offset-2":""}`,children:[(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)("span",{className:"text-lg",children:f?"⏸":"▶"}),(0,b.jsx)("span",{className:"font-display text-sm font-semibold",children:T(a.duration_seconds)}),a.comments.length>0&&(0,b.jsxs)("span",{className:"rounded-full bg-waffle-light/30 px-1.5 py-0.5 text-[10px] font-semibold text-waffle-dark/70",children:[a.comments.length," comment",1!==a.comments.length?"s":""]})]}),a.title&&(0,b.jsx)("p",{className:"mt-1 text-xs font-medium opacity-80",children:a.title}),(0,b.jsx)("p",{className:"mt-1 text-xs font-semibold opacity-80",children:a.sender_name}),(0,b.jsx)("p",{className:"text-xs opacity-60",children:new Date(a.created_at+"Z").toLocaleDateString("en-US",{weekday:"short",month:"short",day:"numeric",hour:"numeric",minute:"2-digit"})})]}),e&&(0,b.jsxs)("div",{className:`mt-2 w-full max-w-[340px] rounded-xl border-2 border-dashed p-4 ${c?"border-waffle-light/50 bg-butter":"border-waffle-light/30 bg-cream"}`,children:[(0,b.jsxs)("div",{className:"mb-3 flex items-center gap-2",children:[(0,b.jsx)("button",{onClick:b=>{b.stopPropagation(),O(a.id)},className:"flex h-8 w-8 shrink-0 items-center justify-center rounded-full bg-waffle text-white",children:(0,b.jsx)("span",{className:"text-sm",children:f?"⏸":"▶"})}),(0,b.jsxs)("div",{className:"flex-1",children:[(0,b.jsx)("div",{className:"h-2 cursor-pointer rounded-full bg-waffle-light/30",onClick:a=>{var b;a.stopPropagation();let c=a.currentTarget.getBoundingClientRect();b=(a.clientX-c.left)/c.width,H.current&&s>0&&(H.current.currentTime=b*s,r(H.current.currentTime))},children:(0,b.jsx)("div",{className:"h-full rounded-full bg-waffle transition-[width] duration-100",style:{width:`${100*g}%`}})}),(0,b.jsxs)("div",{className:"mt-0.5 flex justify-between text-[10px] text-waffle-dark/50",children:[(0,b.jsx)("span",{children:f?T(q):"0:00"}),(0,b.jsx)("span",{children:T(f&&s?s:a.duration_seconds)})]})]})]}),a.transcript&&(0,b.jsx)("div",{className:"mb-3 rounded-lg bg-white/40 p-2 text-xs leading-relaxed text-waffle-dark/80",children:a.transcript}),a.comments.length>0&&(0,b.jsxs)("div",{className:"mb-3 space-y-1.5",children:[(0,b.jsx)("p",{className:"text-[10px] font-semibold uppercase tracking-wider text-waffle-dark/40",children:"Comments"}),a.comments.map(c=>(0,b.jsxs)("div",{onClick:b=>{b.stopPropagation(),f||O(a.id),f?P(c.timestamp_seconds):setTimeout(()=>P(c.timestamp_seconds),300)},className:"flex cursor-pointer gap-2 rounded-lg bg-white/30 px-2 py-1.5 text-xs hover:bg-white/50",children:[(0,b.jsx)("span",{className:"shrink-0 font-mono text-[10px] text-waffle/60",children:T(c.timestamp_seconds)}),(0,b.jsxs)("span",{className:"text-waffle-dark/80",children:[(0,b.jsxs)("span",{className:"font-semibold",children:[c.user_name,":"]})," ",c.text]})]},c.id))]}),(0,b.jsxs)("div",{className:"flex gap-1.5",onClick:a=>a.stopPropagation(),children:[(0,b.jsx)("input",{type:"text",value:C,onChange:a=>D(a.target.value),onKeyDown:b=>"Enter"===b.key&&Q(a.id),placeholder:f?`Comment at ${T(q)}...`:"Add a comment...",className:"flex-1 rounded-lg border border-waffle-light/40 bg-white/50 px-2 py-1.5 text-xs text-waffle-dark outline-none placeholder:text-waffle-dark/30 focus:border-waffle"}),(0,b.jsx)("button",{onClick:()=>Q(a.id),disabled:!C.trim(),className:"rounded-lg bg-waffle px-3 py-1.5 text-xs font-semibold text-white disabled:opacity-30",children:"Send"})]})]})]},a.id)})]}),(0,b.jsx)("div",{className:"sticky bottom-0 mt-auto flex flex-col items-center border-t-2 border-dashed border-waffle-light/40 bg-cream pb-6 pt-5 safe-b",children:m?(0,b.jsxs)("div",{className:"flex items-center gap-3",children:[(0,b.jsx)("span",{className:"inline-block h-5 w-5 animate-spin rounded-full border-2 border-waffle border-t-transparent"}),(0,b.jsx)("p",{className:"font-display font-medium text-waffle-dark",children:"Sending your waffle..."})]}):i?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)("p",{className:"mb-3 font-mono text-2xl font-bold text-red-600 tabular-nums",children:T(k)}),(0,b.jsx)("button",{onClick:M,className:"btn-record btn-record-active","aria-label":"Stop recording",children:(0,b.jsx)("span",{className:"relative z-10 block h-7 w-7 rounded bg-white"})}),(0,b.jsx)("p",{className:"mt-3 text-sm font-medium text-waffle-dark/60",children:"Tap to stop & send"})]}):(0,b.jsxs)(b.Fragment,{children:[A&&(0,b.jsxs)("div",{className:"mb-4 w-full rounded-xl border-2 border-red-200 bg-red-50 p-4 text-left",children:[(0,b.jsx)("p",{className:"font-display text-sm font-semibold text-red-800",children:"Microphone unavailable"}),(0,b.jsx)("p",{className:"mt-1 text-sm leading-relaxed text-red-600",children:A}),(0,b.jsx)("button",{onClick:()=>B(null),className:"mt-2 text-xs font-bold text-red-400 hover:text-red-600",children:"Dismiss"})]}),(0,b.jsx)("button",{onClick:L,className:"btn-record","aria-label":"Start recording",children:(0,b.jsx)("span",{className:"relative z-10 block h-5 w-5 rounded-full bg-white shadow-sm"})}),(0,b.jsx)("p",{className:"mt-3 text-sm font-medium text-waffle-dark/60",children:"Tap to record a waffle"})]})})]})}a.s(["CircleView",()=>d])}];

//# sourceMappingURL=%5Broot-of-the-server%5D__6bbc4fb6._.js.map